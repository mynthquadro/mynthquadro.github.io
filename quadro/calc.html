<html>
<head>
<style>
button{font-size:2em;height:64px;}
.kits-input{display:block;margin-top:0.5em;}
.reducekit{filter:opacity(0);display:inline-block;height:45px;width:45px;}
.kits-amount{display:inline-block;font-size:2em;height:64px;border:none;min-width:2em;}
.kits-row,.part-row{float:left;margin-left:1em;}
.amount{font-size:2em;height:2em;border:none;display:block;min-width:2em;}
.part-row-img{display:block;cursor:pointer;}
.part-row-img>img{width:5em;height:4em;}
.part-num{color:red;}
.part-link{color:#3333}
.part-img{display:none;}
</style>

<script>
let parts;
let partsCh;
let partsImgSrc;

const kits=[["My First QUADRO",0,4,7,0,9,4,1,4,0,0,0,4,30,0,0,0,1,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0],
["STARTER",2,7,6,0,8,8,3,0,0,0,0,0,48,0,0,0,3,0,0,1,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0],
["BASIC",2,10,6,2,8,8,5,4,0,8,0,0,46,0,0,0,4,0,0,1,4,4,4,4,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0],
["JUNIOR",2,10,6,1,10,10,7,4,0,2,0,0,66,0,0,0,5,0,0,2,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0],
["UNIVERSAL",2,14,8,1,10,10,11,4,0,2,0,0,81,0,0,0,8,0,0,2,0,0,0,0,1,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0],
["ULTIMATE",4,23,20,2,18,17,10,8,0,37,0,4,103,0,0,0,16,14,0,0,0,0,0,0,0,4,2,0,1,0,0,0,0,0,0,0,0,0,0,0,0,0],
["BEGINNER",0,4,6,0,5,5,1,4,0,8,0,0,19,0,0,0,1,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0],
["ADVENTURE",0,8,4,0,4,14,2,4,0,10,0,0,34,0,0,0,8,0,0,0,0,0,0,0,0,2,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0],
["ADVENTURE PLUS",2,8,4,1,4,14,2,4,0,10,0,0,34,0,0,0,8,0,4,0,0,0,0,0,0,2,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0],
["KLETTERPYRAMIDE",3,8,15,2,6,5,0,0,0,0,0,0,64,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0],
["EVOLUTION",4,10,12,1,11,12,4,4,0,18,0,4,60,0,0,0,8,9,0,0,2,2,2,2,0,2,0,0,0,2,2,0,0,0,0,0,0,0,0,0,0,0],
["OFFROAD",2,10,6,2,8,8,5,4,0,12,0,0,46,0,0,0,4,2,0,1,0,0,0,4,0,0,2,0,0,0,0,0,0,0,0,0,0,0,4,4,0,0],
["MOeBEL KIT S",1,6,9,0,2,9,1,0,0,6,0,0,35,0,0,0,3,0,0,0,0,0,0,0,0,0,1,0,0,0,0,1,0,0,0,0,0,0,0,0,0,0],
["MOeBEL KIT L",4,13,14,0,11,13,3,0,0,23,0,0,57,0,0,0,4,4,0,0,1,1,1,0,0,0,1,0,0,0,0,1,0,0,0,0,0,0,0,0,0,0],
["MODULARRUTSCHE",0,0,0,0,0,2,6,0,0,4,0,0,7,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,1,1,0,0,0,0,0,0,0,0],
["BOGENRUTSCHE",0,0,0,0,3,4,5,0,1,7,1,3,3,1,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,1,1,0,0,0,0,0,0,0],
["INTEGRALRUTSCHE",0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,1,0,0,0,0,0,0,0,0,0],
["POOL S",0,2,6,0,2,8,1,0,0,13,0,0,9,0,3,0,0,1,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,1,0,0,0,0,0,0],
["POOL L",0,4,16,0,4,4,4,0,0,0,0,0,42,0,4,0,2,0,0,0,0,0,0,0,0,0,2,0,0,0,0,0,0,0,0,0,1,0,0,0,0,0],
["POOL XXL",0,12,20,0,0,4,8,0,0,0,0,0,56,0,6,4,2,0,0,2,0,0,0,0,0,0,6,4,0,0,0,0,0,0,0,0,0,1,0,0,0,0],
["MOBIL",0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,2,2,2,2,0,0,0,0,0,2,2,0,0,0,0,0,0,0,0,0,0,0],
["SPECIAL KIT",0,2,0,0,0,2,0,4,0,6,0,0,0,0,0,2,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0],
["HOME ACTION KIT",0,2,0,1,0,0,3,4,0,3,0,0,0,0,0,0,9,0,0,0,0,0,0,0,1,0,0,0,0,0,0,1,0,0,0,0,0,0,0,0,0,0],
["UPGRADE KIT",0,6,0,0,6,8,4,4,0,16,0,0,13,0,0,0,10,2,0,0,0,0,0,0,0,2,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0],
["YOUNGSTER",0,6,6,0,8,8,4,4,0,2,0,0,41,0,0,0,3,0,0,0,0,0,0,0,0,2,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0],
["GENIUS",3,1,11,1,13,5,4,4,0,2,0,0,86,0,0,0,10,0,0,0,1,1,1,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0]
];

let design;

let recommendhtml=[];
let perpagedefault=10;
let currentpage=0;

window.addEventListener('load', () => {
    /*read data from iframe*/
    const iFrame = document.getElementById('myiframe');
    const iFrameContent = iFrame.contentDocument || iFrame.contentWindow.document;
    parts=iFrameContent.getElementById('parts').textContent.split(',');
    partsCh=iFrameContent.getElementById('partsCh').textContent.split(',');
    partsImgSrc=iFrameContent.getElementById('partsImgSrc').textContent.split(',');
    if(parts.length != partsCh.length || parts.length != partsImgSrc.length){
      console.log("Error:parts data length");
    }
    
    design = iFrameContent.getElementById('design').innerHTML.split('<br>');
    for (let i=0;i<design.length;i++){
      design[i]=design[i].split(',');
      design[i][0]=design[i][0].replace('\n','');
      for (let j=2;j<design[i].length;j++){
        design[i][j]=parseInt(design[i][j]);
      }
    }

  /*fill partslist*/
  let addHtml='';
  for (let i = 0;i<parts.length;i++){
    const p="alert('"+parts[i]+"["+partsCh[i].replaceAll('(','[').replaceAll(')',']')+"]"+"');";
    addHtml+='<div class="part-row"><div class="part-row-img" onclick="'+p+'"><img src="'+partsImgSrc[i]+'"></div><div  contenteditable="true" class="amount"></div></div>';
  }
  document.getElementById("partslistdech").innerHTML=addHtml;

  const kitsbtn=document.getElementsByClassName("addkit");
  const kitsa=document.getElementsByClassName("kits-amount");
  const reducekitsbtn=document.getElementsByClassName("reducekit");
  for (let i =0;i<kitsbtn.length;i++){
    /*click button to add kit and calculate*/
    kitsbtn[i].addEventListener('click', ()=>{
      kitsa[i].textContent=parseInt(kitsa[i].textContent)+1;
      Calc();
    });
  }

  for (let i =0;i<reducekitsbtn.length;i++){
    /*click button to reduce kit and calculate*/
    reducekitsbtn[i].addEventListener('click', ()=>{
      kitsa[i].textContent=parseInt(kitsa[i].textContent)-1;
      Calc();
    });
  }
});

function getdesign(){
    currentpage=0;
    recommendhtml=[];
    document.getElementById('re-current').textContent='';
    document.getElementsByClassName('re-container')[0].innerHTML='';
    document.getElementsByClassName('re-footer')[0].style.display='none';
    document.getElementsByClassName('recommendinfo')[0].textContent='';

    let imgwidth=9;
    if(window.innerWidth<window.innerHeight+100){
        imgwidth=18;
    }
    const amounts=document.getElementsByClassName('amount');
    let pass,info,designamount,resulthtml='',havePartNum;
    for (let i =0;i<design.length;i++){
        pass=true;
        info='';
        for (let j =0;j<amounts.length;j++){
            designamount=design[i][j+2];/*design[i][0]:designname,design[i][1]:img_num*/
            havePartNum=amounts[j].textContent ? parseInt(amounts[j].textContent) : 0;
            if (havePartNum<designamount){
                if (j==18 && parseInt(amounts[16].textContent)>=(design[i][20]+design[i][18]+design[i][43])){
                    info+='<div>you need '+designamount+' Lochplatte or replace with Lochplatte 40 × 40 cm.</div>';
                }else if(j==19 || j==24 || j==28){
                    info+='<div>Textile is not included.</div>';
                }/*else if(j==20){
                    info+='<div>you need '+designamount+' Multirad.</div>';
                }else if(j==21){
                    info+='<div>you need '+designamount+' Multirad Radlager.</div>';
                }else if(j==22){
                    info+='<div>you need '+designamount+' Multirad Arretierung.</div>';
                }*/else if(j==25){
                    info+='<div>you need '+designamount+' Doppelrohrverbinder or replace with tie wrap.</div>';
                }else if(j==26 || j==27){
                    info+='<div>you need '+designamount+' alu or replace it.</div>';
                }else if(j==31){
                    info+='<div>you need '+designamount+' Spielsack.</div>';
                }else if(j==35 || j==36 || j==37){
                    info+='<div>you need '+designamount+' Pool.</div>';
                }else if(j==41 && parseInt(amounts[16].textContent)>=(design[i][20]+design[i][18]+design[i][43])){
                    info+='<div>you need '+designamount+' Plexiglass or replace with Lochplatte 40 × 40 cm.</div>';
                }else{
                    /*console.log('design'+i+','+parts[j]+':'+amounts[j].textContent+'<'+designamount);*/
                    pass=false;
                    break;
                }
            }
        }
        if(pass){
            if(design[i][0].substring(0,1)=='M'){
                recommendhtml.push('<div class="possible" style="display:inline-block;"><a target="_blank" href="../quadro/diy/'
                                   +design[i][0]+
                                   '.pdf"><img style="height:8em;width:'+imgwidth+'vw;cursor:pointer;object-fit:contain;" src="../quadro/diy/'
                                   +design[i][0]+
                                   '.JPG"></a><div style="display:none;">'
                                   +info+'</div></div>');
            }else{
                recommendhtml.push('<div class="possible" style="display:inline-block;"><a target="_blank" href="https://quadromdb.com/de/designs/'
                                   +design[i][0]+
                                   '"><img style="height:8em;width:'+imgwidth+'vw;object-fit:contain;" src="../quadro/webimg/'
                                   +design[i][0].toUpperCase()+'-brand.webp"></a><div style="display:none;">'
                                   +info+'</div></div>');
            }

        }
    }

    if(recommendhtml.length==0){
      document.getElementsByClassName('recommendinfo')[0].textContent='No available design.';
      document.getElementsByClassName('re-footer')[0].style.display='none';
    }else{
      document.getElementsByClassName('recommendinfo')[0].textContent='Available design: '+recommendhtml.length;
      document.getElementsByClassName('re-footer')[0].style.display='block';
      forpage(0,perpagedefault);
    }
}

function forpage(page,perpage){
    currentpage=page;
    perpagedefault=perpage;
    let maxindex = perpagedefault;
    let pagehtml='';
    if(page==0){
      document.getElementById('re-prev').disabled = true;
    }else{
      document.getElementById('re-prev').disabled = false;
    }
    if((page+1)*perpage >= recommendhtml.length){
      document.getElementById('re-next').disabled = true;
      maxindex=recommendhtml.length-page*perpage;
    }else{
      document.getElementById('re-next').disabled = false;
    }
    for (let i =0;i<maxindex;i++){
        pagehtml+=recommendhtml[page*perpagedefault+i];
    }
    document.getElementsByClassName('re-container')[0].innerHTML=pagehtml;
    document.getElementById('re-current').textContent=currentpage+1;
}

function prevpage(){
  currentpage--;
  forpage(currentpage,perpagedefault);
}
function nextpage(){
  currentpage++;
  forpage(currentpage,perpagedefault);
}

function showdesign(obj){
    document.getElementsByClassName('pdf-container')[0].style.display='block';
    document.getElementsByClassName('design-info')[0].innerHTML=obj.nextSibling.innerHTML;
    document.getElementsByClassName('design-pdf')[0].src=obj.src.replace('JPG','pdf');
}


function ResetKitsNum(){
  ResetPartsNum();
  const rs=document.querySelectorAll('.kits-amount');
  rs.forEach(
    function(listObj){
      listObj.textContent='0';
      listObj.nextElementSibling.style.filter="opacity(0)";
    }
  );
    /*reset available design*/
    currentpage=0;
    recommendhtml=[];
    document.getElementById('re-current').textContent='';
    document.getElementsByClassName('re-container')[0].innerHTML='';
    document.getElementsByClassName('re-footer')[0].style.display='none';
    document.getElementsByClassName('recommendinfo')[0].textContent='';
}

function ResetPartsNum(){
const rs=document.querySelectorAll('.amount');
rs.forEach(
  function(listObj){
    listObj.textContent='';
  }
);
}

function Calc(){
  ResetPartsNum();
  let rs=[],result,temp;
  const cks=document.querySelectorAll('.kits-amount');
  /*kit name and amount to Array*/
  for (let i =0;i<cks.length;i++){
          const n = parseInt(cks[i].textContent);
          if(isNaN(n) || n<=0){
            cks[i].textContent='0';
            cks[i].nextElementSibling.style.filter="opacity(0)";
            continue;
          }else{
            cks[i].nextElementSibling.style.filter="opacity(1)";
            rs.push(i,n);
          }
  }

  /*find kits data and calculate*/
  for (let i =0;i<rs.length;i+=2){
    for (let j =1;j<kits[rs[i]].length;j++){
      if (kits[rs[i]][j]==0){
        continue;
      }
      temp=document.querySelectorAll('.amount')[j-1].textContent;
      if (temp==''){
        temp=0;
      }else{
        temp=parseInt(temp);
      }
      temp+=kits[rs[i]][j] * rs[i+1];
      if(temp==0){
         document.querySelectorAll('.amount')[j-1].textContent='';
      }else{
         document.querySelectorAll('.amount')[j-1].textContent=temp;
      }
    }
  }
}


</script>
</head>

<body>
<div style="display:block;" class="info">
Click kit name or enter their amounts below. 请点击套装名字进行添加或在其下方手动输入数量。
</div>

<div class="kits-row"><button class="addkit" >My First</button><div class="kits-input"><div  contenteditable="true" oninput="Calc();" class="kits-amount" name="My First QUADRO">0</div><button class="reducekit">-</button></div></div>
<div class="kits-row"><button class="addkit" >STARTER</button><div class="kits-input"><div  contenteditable="true" oninput="Calc();" class="kits-amount" name="STARTER">0</div><button class="reducekit">-</button></div></div>
<div class="kits-row"><button class="addkit" >BASIC</button><div class="kits-input"><div  contenteditable="true" oninput="Calc();" class="kits-amount" name="BASIC">0</div><button class="reducekit">-</button></div></div>
<div class="kits-row"><button class="addkit" >JUNIOR</button><div class="kits-input"><div  contenteditable="true" oninput="Calc();" class="kits-amount" name="JUNIOR">0</div><button class="reducekit">-</button></div></div>
<div class="kits-row"><button class="addkit" >UNIVERSAL</button><div class="kits-input"><div  contenteditable="true" oninput="Calc();" class="kits-amount" name="UNIVERSAL">0</div><button class="reducekit">-</button></div></div>
<div class="kits-row"><button class="addkit" >ULTIMATE</button><div class="kits-input"><div  contenteditable="true" oninput="Calc();" class="kits-amount" name="ULTIMATE">0</div><button class="reducekit">-</button></div></div>
<div class="kits-row"><button class="addkit" >BEGIN</button><div class="kits-input"><div  contenteditable="true" oninput="Calc();" class="kits-amount" name="BEGINNER">0</div><button class="reducekit">-</button></div></div>
<div class="kits-row"><button class="addkit" >ADV</button><div class="kits-input"><div  contenteditable="true" oninput="Calc();" class="kits-amount" name="ADVENTURE">0</div><button class="reducekit">-</button></div></div>
<div class="kits-row"><button class="addkit" >ADV+</button><div class="kits-input"><div  contenteditable="true" oninput="Calc();" class="kits-amount" name="ADVENTURE PLUS">0</div><button class="reducekit">-</button></div></div>
<div class="kits-row"><button class="addkit" >KL(CL)</button><div class="kits-input"><div  contenteditable="true" oninput="Calc();" class="kits-amount" name="KLETTERPYRAMIDE">0</div><button class="reducekit">-</button></div></div>
<div class="kits-row"><button class="addkit" >EVO</button><div class="kits-input"><div  contenteditable="true" oninput="Calc();" class="kits-amount" name="EVOLUTION">0</div><button class="reducekit">-</button></div></div>
<div class="kits-row"><button class="addkit" >OFFROAD</button><div class="kits-input"><div  contenteditable="true" oninput="Calc();" class="kits-amount" name="OFFROAD">0</div><button class="reducekit">-</button></div></div>
<div class="kits-row"><button class="addkit" >MOeBEL S</button><div class="kits-input"><div  contenteditable="true" oninput="Calc();" class="kits-amount" name="MOeBEL KIT S">0</div><button class="reducekit">-</button></div></div>
<div class="kits-row"><button class="addkit" >MOeBEL L</button><div class="kits-input"><div  contenteditable="true" oninput="Calc();" class="kits-amount" name="MOeBEL KIT L">0</div><button class="reducekit">-</button></div></div>
<div class="kits-row"><button class="addkit" style="font-size:1.5em;">MOD-RUTSCH<br>(模块滑梯)</button><div class="kits-input"><div  contenteditable="true" oninput="Calc();" class="kits-amount" name="MODULARRUTSCHE">0</div><button class="reducekit">-</button></div></div>
<div class="kits-row"><button class="addkit" style="font-size:1.5em;">BOG-RUTSCH<br>(弧形滑梯)</button><div class="kits-input"><div  contenteditable="true" oninput="Calc();" class="kits-amount" name="BOGENRUTSCHE">0</div><button class="reducekit">-</button></div></div>
<div class="kits-row"><button class="addkit" style="font-size:1.5em;">INT-RUTSCH<br>(整合滑梯)</button><div class="kits-input"><div  contenteditable="true" oninput="Calc();" class="kits-amount" name="INTEGRALRUTSCHE">0</div><button class="reducekit">-</button></div></div>
<div class="kits-row"><button class="addkit" >POOL S</button><div class="kits-input"><div  contenteditable="true" oninput="Calc();" class="kits-amount" name="POOL S">0</div><button class="reducekit">-</button></div></div>
<div class="kits-row"><button class="addkit" >POOL L</button><div class="kits-input"><div  contenteditable="true" oninput="Calc();" class="kits-amount" name="POOL L">0</div><button class="reducekit">-</button></div></div>
<div class="kits-row"><button class="addkit" >POOL XXL</button><div class="kits-input"><div  contenteditable="true" oninput="Calc();" class="kits-amount" name="POOL XXL">0</div><button class="reducekit">-</button></div></div>
<div class="kits-row"><button class="addkit" >MOBIL</button><div class="kits-input"><div  contenteditable="true" oninput="Calc();" class="kits-amount" name="MOBIL">0</div><button class="reducekit">-</button></div></div>
<div class="kits-row"><button class="addkit" >SPECIAL</button><div class="kits-input"><div  contenteditable="true" oninput="Calc();" class="kits-amount" name="SPECIAL KIT">0</div><button class="reducekit">-</button></div></div>
<div class="kits-row"><button class="addkit" >HOME</button><div class="kits-input"><div  contenteditable="true" oninput="Calc();" class="kits-amount" name="HOME ACTION KIT">0</div><button class="reducekit">-</button></div></div>
<div class="kits-row"><button class="addkit" >UPGRADE</button><div class="kits-input"><div  contenteditable="true" oninput="Calc();" class="kits-amount" name="UPGRADE KIT">0</div><button class="reducekit">-</button></div></div>
<div class="kits-row"><button class="addkit" >YOUNGSTER</button><div class="kits-input"><div  contenteditable="true" oninput="Calc();" class="kits-amount" name="YOUNGSTER">0</div><button class="reducekit">-</button></div></div>
<div class="kits-row"><button class="addkit" >GENIUS</button><div class="kits-input"><div  contenteditable="true" oninput="Calc();" class="kits-amount" name="GENIUS">0</div><button class="reducekit">-</button></div></div>

<div style="clear:left;">
<hr>
<button onclick="ResetKitsNum();">Reset（重置）</button>
<br><div style="font-size:1.9em;margin-left:1.5em;display:inline;" class="coupon">
&#127873;<span style="font-weight:700;">10% Coupon</span> for quadro shop <span style="font-size:0.9em;">官网优惠券：欧洲（不含英国）</span><img style='height:1em;' src='Flag_of_Europe.svg'>Cheryl_EU_10 <span style="font-size:0.9em;">美国</span><img style='height:1em;' src='Flag_of_the_United_States.svg'>Cheryl_US_10
</div>
</div>

<div class="parts-info">Click the number or blank under the images to input amounts of parts manually. 点击零件图片下方的数字或空白可手动输入零件数。</div>
<div id="partslistdech" style="margin-top:1.5em;">
loading
</div>

<div class='recommend' style="clear:left;">
  <button onclick="getdesign();">Available models模型/Refresh刷新</button>
  <br>Texile,double tube connector,alu-profile and pools are not considered. Holey panel and plexiglass could be replaced. 
  布品、8字件、铝管及泳池布不考虑在计算结果内，洞洞板及亚克力板可被普通板代替。
  <div></div>
  <div class='recommendinfo'>
  </div>
  <div class='re-container'>
  </div>
  <div class='re-footer' style="display:none;">
    <span style="font-size:2em;">models per page: </span>
    <select style="font-size:2em;" id="re-page" onchange="forpage(0,this.value);">
      <option value="10">10</option>
      <option value="20">20</option>
      <option value="50">50</option>
    </select>
    <button id="re-prev" onclick="prevpage();" style="margin-left:1em;">prev</button>
    <div id="re-current" style="display:inline-block;font-size:2em;color:#0008;min-width:1.5em;text-align: center;"></div>
    <button id="re-next" onclick="nextpage();">next</button>
  </div>
</div>

<div class='pdf-container' style="display:none;border:1px solid grey;position:fixed;left:10vw;top:10vh;width:80vw;height:80vh;background:white;">
  <div class="container-head">
    detail
    <span style="border:1px solid #5555;cursor:pointer;display:inline-block;width:1em;height:1em;float: right;text-align:center;line-height:1em;" onclick="document.getElementsByClassName('pdf-container')[0].style.display='none';"> X </span>
  </div>
  <div class="design-info"></div>
  <div>
    <iframe class="design-pdf" style="width:100%;height:100%;"></iframe>
  </div>
</div>
<div style="margin-top:5em;"> </div>
<hr>
Copy right of images from quadromdb.com belongs to QUADRO. Copy right of images from quadro fans belongs to the authors.
quadromdb.com下载的模型缩图版权属于QUADRO，爱好者设计的模型及照片版权属于作者。
<iframe id="myiframe" style="display:none;" src="quadrodata.html">
</body>
</html>
